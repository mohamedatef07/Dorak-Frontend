<!-- Doctor Profile Section -->
@if(loading) {
<div class="loader-container">
  <p-progressSpinner ariaLabel="loading" animationDuration=".5s">
  </p-progressSpinner>
</div>
} @else {
<div class="doctor-profile-section">
  <div class="doctor-avatar">
    @if(doctorMainInfo.Image && !hasImageLoadFailed('doctor')){
    <img
      [src]="doctorMainInfo.Image"
      alt="Doctor"
      class="doctor-image"
      (error)="onImageError($event, 'doctor')"
    />
    }@else{
    <p-avatar
      icon="pi pi-user"
      size="xlarge"
      shape="circle"
      class="doctor-image"
    />
    }
  </div>
  <div class="doctor-info">
    <h4 class="doctor-name">{{ doctorMainInfo.FullName }}</h4>
    <p class="doctor-specialty">
      <i class="fas fa-user-md me-1"></i>
      {{ doctorMainInfo.Specialization }}
    </p>
    <div class="rating-container mb-2">
      <p-rating
        class="star pt-2 pb-2"
        [(ngModel)]="doctorMainInfo.Rate"
        [readonly]="true"
      />
      <span class="rating-text ms-2">{{ doctorMainInfo.Rate }}</span>
    </div>
  </div>
</div>

<!-- Queue Status Overview -->
<div class="queue-status-section">
  <div class="section-header">
    <h5 class="section-title">
      <i class="fas fa-chart-line"></i>
      Queue Status
    </h5>
  </div>
  <div class="status-grid">
    <div class="status-card current">
      <div class="status-icon">
        <i class="fas fa-user-clock"></i>
      </div>
      <div class="status-content">
        <h3 class="status-number">
          {{ getClientCurrentNumber() == 0 ? "NA" : getClientCurrentNumber() }}
        </h3>
        <p class="status-label">Current</p>
      </div>
    </div>
    <div class="status-card total">
      <div class="status-icon">
        <i class="fas fa-users"></i>
      </div>
      <div class="status-content">
        <h3 class="status-number">{{ LiveQueues.length }}</h3>
        <p class="status-label">In Queue</p>
      </div>
    </div>
    <div class="status-card my-position">
      <div class="status-icon">
        <i class="fas fa-user-check"></i>
      </div>
      <div class="status-content">
        <h3 class="status-number">{{ getClientPosition() }}</h3>
        <p class="status-label">My Position</p>
      </div>
    </div>
  </div>
</div>

<!-- Estimated Wait Time -->
<div class="wait-time-section">
  <div class="section-header">
    <h5 class="section-title">
      <i class="fas fa-clock"></i>
      Estimated Wait Time
    </h5>
  </div>
  <div class="progress-container">
    <div class="progress-bar">
      <div class="progress-fill" [style.width.%]="waitingProgress"></div>
    </div>
    <div class="time-display">
      <span class="time-text">{{ estimatedTime }}</span>
    </div>
  </div>
</div>

<!-- Live Queue List -->
<div class="queue-list-section">
  <div class="section-header">
    <h5 class="section-title">
      <i class="fas fa-list-ol"></i>
      Live Queue
    </h5>
  </div>
  <div class="queue-list">
    <p-carousel
      class="pcar"
      [value]="LiveQueues"
      [numVisible]="4"
      [numScroll]="4"
      orientation="vertical"
    >
      >
      <ng-template let-entry #item>
        <div class="entry m-2">
          <div
            class="queue-item"
            [ngClass]="{
              completed: entry.Status === QueueAppointmentStatus.Completed,
              'in-progress': entry.Status === QueueAppointmentStatus.InProgress,
              waiting: entry.Status === QueueAppointmentStatus.Waiting,
              'not-checked': entry.Status === QueueAppointmentStatus.NotChecked,
              'current-user': entry.IsCurrentClient
            }"
          >
            <div class="queue-item-content">
              <div class="user-info">
                <div class="client-avatar">
                  @if(entry.IsCurrentClient && fullImagePath &&
                  !hasImageLoadFailed('client')){
                  <img
                    [src]="fullImagePath"
                    alt="User"
                    class="avatar-image"
                    (error)="onImageError($event, 'client')"
                  />
                  }@else{
                  <p-avatar
                    icon="pi pi-user"
                    class="mr-2"
                    size="large"
                    shape="circle"
                  />
                  }
                </div>
                <div class="user-details">
                  <span class="user-name">{{
                    entry.IsCurrentClient ? clientInfo.Name : "Anonymous"
                  }}</span>
                  <span class="status-text">{{
                    getStatusText(entry.Status)
                  }}</span>
                </div>
              </div>
              <div class="position-badge">
                <span class="position-number"
                  >#{{ entry.CurrentQueuePosition }}</span
                >
              </div>
            </div>
          </div>
        </div>
      </ng-template>
    </p-carousel>
  </div>
</div>
}
