<div class="register-container">
  <p-toast></p-toast>

  <div class="container-fluid h-100 p-0">
    <div class="row h-100 g-0" style="min-height: 100vh;">
      <!-- Left Side - Illustration -->
      <div class="col-12 col-md-4 d-flex align-items-center justify-content-center p-0 left-illustration-col">
        <div class="illustration-container w-100 h-100">
          <!-- Illustration content here -->
          <div class="illustration-wrapper d-flex align-items-center justify-content-center w-100 h-100">
            <div class="text-center">
              <i class="pi pi-user-plus" style="font-size: 8rem; color: var(--main-bg-color-Light);"></i>
              <h3 class="mt-3">Join Our Platform</h3>
              <p class="text-muted">Create your account and start managing queues efficiently</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Right Side - Registration Form -->
      <div class="col-12 col-md-8 d-flex align-items-center justify-content-center p-0 right-register-col">
        <div class="register-form-container mx-auto">
          <div class="register-header mb-2">
            <div class="logo-section d-flex align-items-center mb-3">
              <div class="logo-icon">
                <i class="pi pi-shield text-primary"></i>
              </div>
              <h3 class="logo-text ms-2 mb-0">Sleeknote</h3>
            </div>
            <h1 class="welcome-title">Create Account</h1>
            <p class="welcome-subtitle">Join us to manage your queues efficiently</p>
          </div>

          <!-- Registration Stepper -->
          <p-steps [model]="steps" [readonly]="false" [activeIndex]="activeStepIndex"></p-steps>

          <!-- Step Content -->
          <div class="step-content mt-4">
            <!-- Step 1: Main Data -->
            <div *ngIf="activeStepIndex === 0" class="step-panel">
              <form #mainDataForm="ngForm">
                <!-- Username Field -->
                <div class="field mb-3">
                  <label for="username" class="form-label">Username</label>
                  <input type="text" pInputText id="username" name="username" [(ngModel)]="registrationData.username" 
                    placeholder="Enter your username" class="form-control" required #usernameInput="ngModel" />
                  <div *ngIf="usernameInput.invalid && usernameInput.touched" class="text-danger mt-1">
                    <small>Username is required</small>
                  </div>
                </div>

                <!-- Email Field -->
                <div class="field mb-3">
                  <label for="email" class="form-label">Email</label>
                  <input type="email" pInputText id="email" name="email" [(ngModel)]="registrationData.email" 
                    placeholder="Enter your email" class="form-control" required #emailInput="ngModel" />
                  <div *ngIf="emailInput.invalid && emailInput.touched" class="text-danger mt-1">
                    <small>Please enter a valid email address</small>
                  </div>
                </div>

                <!-- Phone Number Field -->
                <div class="field mb-3">
                  <label for="phoneNumber" class="form-label">Phone Number</label>
                  <input type="tel" pInputText id="phoneNumber" name="phoneNumber" [(ngModel)]="registrationData.phoneNumber" 
                    placeholder="Enter your phone number" class="form-control" required #phoneNumberInput="ngModel" />
                  <div *ngIf="phoneNumberInput.invalid && phoneNumberInput.touched" class="text-danger mt-1">
                    <small>Phone number is required</small>
                  </div>
                </div>

                <!-- Password Field -->
                <div class="field mb-3">
                  <label for="password" class="form-label">Password</label>
                  <input [type]="showPassword ? 'text' : 'password'" pInputText id="password" name="password" 
                    [(ngModel)]="registrationData.password" placeholder="Enter your password" 
                    class="form-control" required #passwordInput="ngModel" />
                  <div *ngIf="passwordInput.invalid && passwordInput.touched" class="text-danger mt-1">
                    <small>Password is required</small>
                  </div>
                </div>

                <!-- Confirm Password Field -->
                <div class="field mb-3">
                  <label for="confirmPassword" class="form-label">Confirm Password</label>
                  <input [type]="showPassword ? 'text' : 'password'" pInputText id="confirmPassword" name="confirmPassword" 
                    [(ngModel)]="registrationData.confirmPassword" placeholder="Confirm your password" 
                    class="form-control" required #confirmPasswordInput="ngModel" />
                  <div *ngIf="confirmPasswordInput.invalid && confirmPasswordInput.touched" class="text-danger mt-1">
                    <small>Please confirm your password</small>
                  </div>
                  <div *ngIf="registrationData.password !== registrationData.confirmPassword && registrationData.confirmPassword" 
                    class="text-danger mt-1">
                    <small>Passwords do not match</small>
                  </div>
                </div>

                <!-- Role Selection -->
                <div class="field mb-4">
                  <label for="role" class="form-label">Select Role</label>
                  <p-dropdown id="role" name="role" [options]="roles" [(ngModel)]="registrationData.role" 
                    placeholder="Choose your role" optionLabel="name" optionValue="value" 
                    class="w-100" [required]="true" #roleInput="ngModel">
                  </p-dropdown>
                  <div *ngIf="roleInput.invalid && roleInput.touched" class="text-danger mt-1">
                    <small>Please select a role</small>
                  </div>
                </div>
              </form>
            </div>

            <!-- Step 2: Role-specific Data -->
            <div *ngIf="activeStepIndex === 1" class="step-panel">
              <!-- No Role Selected Message -->
              <div *ngIf="!registrationData.role" class="no-role-message">
                <div class="text-center">
                  <i class="pi pi-exclamation-triangle" style="font-size: 3rem; color: #ffc107; margin-bottom: 1rem;"></i>
                  <h4 class="text-warning mb-3">Role Not Selected</h4>
                  <p class="text-muted mb-4">You need to select a role in the first step to continue.</p>
                  <p-button label="Go Back to Step 1" icon="pi pi-arrow-left" 
                    styleClass="p-button-secondary" (onClick)="previousStep()">
                  </p-button>
                </div>
              </div>

              <!-- Client-specific fields -->
              <div *ngIf="registrationData.role === 'Client'" class="role-specific-content">
                <h4 class="mb-3">Client Information</h4>
                <form #clientForm="ngForm">
                  <!-- First Name -->
                  <div class="field mb-3">
                    <label for="firstName" class="form-label">First Name</label>
                    <input type="text" pInputText id="firstName" name="firstName" [(ngModel)]="registrationData.firstName" 
                      placeholder="Enter your first name" class="form-control" required #firstNameInput="ngModel" />
                    <div *ngIf="firstNameInput.invalid && firstNameInput.touched" class="text-danger mt-1">
                      <small>First name is required</small>
                    </div>
                  </div>

                  <!-- Last Name -->
                  <div class="field mb-3">
                    <label for="lastName" class="form-label">Last Name</label>
                    <input type="text" pInputText id="lastName" name="lastName" [(ngModel)]="registrationData.lastName" 
                      placeholder="Enter your last name" class="form-control" required #lastNameInput="ngModel" />
                    <div *ngIf="lastNameInput.invalid && lastNameInput.touched" class="text-danger mt-1">
                      <small>Last name is required</small>
                    </div>
                  </div>

                  <!-- Gender -->
                  <div class="field mb-3">
                    <label for="gender" class="form-label">Gender</label>
                    <p-dropdown id="gender" name="gender" [options]="['Male', 'Female']" [(ngModel)]="registrationData.gender" 
                      placeholder="Select your gender" class="w-100" [required]="true" #genderInput="ngModel">
                    </p-dropdown>
                    <div *ngIf="genderInput.invalid && genderInput.touched" class="text-danger mt-1">
                      <small>Gender is required</small>
                    </div>
                  </div>

                  <!-- Street -->
                  <div class="field mb-3">
                    <label for="street" class="form-label">Street</label>
                    <input type="text" pInputText id="street" name="street" [(ngModel)]="registrationData.street" 
                      placeholder="Enter your street address" class="form-control" required #streetInput="ngModel" />
                    <div *ngIf="streetInput.invalid && streetInput.touched" class="text-danger mt-1">
                      <small>Street is required</small>
                    </div>
                  </div>

                  <!-- City -->
                  <div class="field mb-3">
                    <label for="city" class="form-label">City</label>
                    <input type="text" pInputText id="city" name="city" [(ngModel)]="registrationData.city" 
                      placeholder="Enter your city" class="form-control" required #cityInput="ngModel" />
                    <div *ngIf="cityInput.invalid && cityInput.touched" class="text-danger mt-1">
                      <small>City is required</small>
                    </div>
                  </div>

                  <!-- Governorate -->
                  <div class="field mb-3">
                    <label for="governorate" class="form-label">Governorate</label>
                    <input type="text" pInputText id="governorate" name="governorate" [(ngModel)]="registrationData.governorate" 
                      placeholder="Enter your governorate" class="form-control" required #governorateInput="ngModel" />
                    <div *ngIf="governorateInput.invalid && governorateInput.touched" class="text-danger mt-1">
                      <small>Governorate is required</small>
                    </div>
                  </div>

                  <!-- Country -->
                  <div class="field mb-3">
                    <label for="country" class="form-label">Country</label>
                    <input type="text" pInputText id="country" name="country" [(ngModel)]="registrationData.country" 
                      placeholder="Enter your country" class="form-control" required #countryInput="ngModel" />
                    <div *ngIf="countryInput.invalid && countryInput.touched" class="text-danger mt-1">
                      <small>Country is required</small>
                    </div>
                  </div>

                  <!-- Birth Date -->
                  <div class="field mb-3">
                    <label for="birthDate" class="form-label">Date of Birth</label>
                    <p-calendar id="birthDate" name="birthDate" [(ngModel)]="registrationData.birthDate" 
                      placeholder="Select your date of birth" class="w-100" [required]="true" #birthDateInput="ngModel">
                    </p-calendar>
                    <div *ngIf="birthDateInput.invalid && birthDateInput.touched" class="text-danger mt-1">
                      <small>Date of birth is required</small>
                    </div>
                  </div>

                  <!-- Image -->
                  <div class="field mb-3">
                    <label for="image" class="form-label">Profile Image</label>
                    <input type="file" pInputText id="image" name="image" [(ngModel)]="registrationData.image" 
                      placeholder="Upload your profile image" class="form-control" accept="image/*" />
                  </div>
                </form>
              </div>

              <!-- Provider-specific fields -->
              <div *ngIf="registrationData.role === 'Provider'" class="role-specific-content">
                <h4 class="mb-3">Provider Information</h4>
                <form #providerForm="ngForm">
                  <!-- First Name -->
                  <div class="field mb-3">
                    <label for="firstName" class="form-label">First Name</label>
                    <input type="text" pInputText id="firstName" name="firstName" [(ngModel)]="registrationData.firstName" 
                      placeholder="Enter your first name" class="form-control" required #firstNameInput="ngModel" />
                    <div *ngIf="firstNameInput.invalid && firstNameInput.touched" class="text-danger mt-1">
                      <small>First name is required</small>
                    </div>
                  </div>

                  <!-- Last Name -->
                  <div class="field mb-3">
                    <label for="lastName" class="form-label">Last Name</label>
                    <input type="text" pInputText id="lastName" name="lastName" [(ngModel)]="registrationData.lastName" 
                      placeholder="Enter your last name" class="form-control" required #lastNameInput="ngModel" />
                    <div *ngIf="lastNameInput.invalid && lastNameInput.touched" class="text-danger mt-1">
                      <small>Last name is required</small>
                    </div>
                  </div>

                  <!-- Gender -->
                  <div class="field mb-3">
                    <label for="gender" class="form-label">Gender</label>
                    <p-dropdown id="gender" name="gender" [options]="['Male', 'Female']" [(ngModel)]="registrationData.gender" 
                      placeholder="Select your gender" class="w-100" [required]="true" #genderInput="ngModel">
                    </p-dropdown>
                    <div *ngIf="genderInput.invalid && genderInput.touched" class="text-danger mt-1">
                      <small>Gender is required</small>
                    </div>
                  </div>

                  <!-- Street -->
                  <div class="field mb-3">
                    <label for="street" class="form-label">Street</label>
                    <input type="text" pInputText id="street" name="street" [(ngModel)]="registrationData.street" 
                      placeholder="Enter your street address" class="form-control" required #streetInput="ngModel" />
                    <div *ngIf="streetInput.invalid && streetInput.touched" class="text-danger mt-1">
                      <small>Street is required</small>
                    </div>
                  </div>

                  <!-- City -->
                  <div class="field mb-3">
                    <label for="city" class="form-label">City</label>
                    <input type="text" pInputText id="city" name="city" [(ngModel)]="registrationData.city" 
                      placeholder="Enter your city" class="form-control" required #cityInput="ngModel" />
                    <div *ngIf="cityInput.invalid && cityInput.touched" class="text-danger mt-1">
                      <small>City is required</small>
                    </div>
                  </div>

                  <!-- Governorate -->
                  <div class="field mb-3">
                    <label for="governorate" class="form-label">Governorate</label>
                    <input type="text" pInputText id="governorate" name="governorate" [(ngModel)]="registrationData.governorate" 
                      placeholder="Enter your governorate" class="form-control" required #governorateInput="ngModel" />
                    <div *ngIf="governorateInput.invalid && governorateInput.touched" class="text-danger mt-1">
                      <small>Governorate is required</small>
                    </div>
                  </div>

                  <!-- Country -->
                  <div class="field mb-3">
                    <label for="country" class="form-label">Country</label>
                    <input type="text" pInputText id="country" name="country" [(ngModel)]="registrationData.country" 
                      placeholder="Enter your country" class="form-control" required #countryInput="ngModel" />
                    <div *ngIf="countryInput.invalid && countryInput.touched" class="text-danger mt-1">
                      <small>Country is required</small>
                    </div>
                  </div>

                  <!-- Birth Date -->
                  <div class="field mb-3">
                    <label for="birthDate" class="form-label">Date of Birth</label>
                    <p-calendar id="birthDate" name="birthDate" [(ngModel)]="registrationData.birthDate" 
                      placeholder="Select your date of birth" class="w-100" [required]="true" #birthDateInput="ngModel">
                    </p-calendar>
                    <div *ngIf="birthDateInput.invalid && birthDateInput.touched" class="text-danger mt-1">
                      <small>Date of birth is required</small>
                    </div>
                  </div>

                  <!-- Image -->
                  <div class="field mb-3">
                    <label for="image" class="form-label">Profile Image</label>
                    <input type="file" pInputText id="image" name="image" [(ngModel)]="registrationData.image" 
                      placeholder="Upload your profile image" class="form-control" accept="image/*" />
                  </div>

                  <!-- Specialization -->
                  <div class="field mb-3">
                    <label for="specialization" class="form-label">Specialization</label>
                    <p-dropdown id="specialization" name="specialization" [options]="specializations" 
                      [(ngModel)]="selectedSpecialization" placeholder="Select your specialization" 
                      class="w-100" [required]="true" #specializationInput="ngModel"
                      [filter]="true" [showClear]="true"
                      (onChange)="onSpecializationChange()">
                    </p-dropdown>
                    <div *ngIf="specializationInput.invalid && specializationInput.touched" class="text-danger mt-1">
                      <small>Specialization is required</small>
                    </div>
                  </div>

                  <!-- Custom Specialization Input -->
                  <div *ngIf="showCustomSpecialization" class="field mb-3 custom-specialization-input">
                    <label for="customSpecialization" class="form-label">Custom Specialization</label>
                    <input type="text" pInputText id="customSpecialization" name="customSpecialization" 
                      [(ngModel)]="registrationData.specialization" placeholder="Enter your custom specialization" 
                      class="form-control" required #customSpecializationInput="ngModel"
                      (input)="onCustomSpecializationInput()" />
                    <div *ngIf="customSpecializationInput.invalid && customSpecializationInput.touched" class="text-danger mt-1">
                      <small>Custom specialization is required</small>
                    </div>
                  </div>

                  <!-- Bio -->
                  <div class="field mb-3">
                    <label for="bio" class="form-label">Bio</label>
                    <textarea pInputTextarea id="bio" name="bio" [(ngModel)]="registrationData.bio" 
                      placeholder="Tell us about yourself and your experience" class="form-control" rows="4" 
                      required #bioInput="ngModel"></textarea>
                    <div *ngIf="bioInput.invalid && bioInput.touched" class="text-danger mt-1">
                      <small>Bio is required</small>
                    </div>
                  </div>

                  <!-- Experience Years -->
                  <div class="field mb-3">
                    <label for="experienceYears" class="form-label">Years of Experience</label>
                    <input type="number" pInputText id="experienceYears" name="experienceYears" 
                      [(ngModel)]="registrationData.experienceYears" placeholder="Enter years of experience" 
                      class="form-control" required min="0" max="50" #experienceYearsInput="ngModel" />
                    <div *ngIf="experienceYearsInput.invalid && experienceYearsInput.touched" class="text-danger mt-1">
                      <small>Years of experience is required</small>
                    </div>
                  </div>

                  <!-- License Number -->
                  <div class="field mb-3">
                    <label for="licenseNumber" class="form-label">License Number</label>
                    <input type="text" pInputText id="licenseNumber" name="licenseNumber" 
                      [(ngModel)]="registrationData.licenseNumber" placeholder="Enter your license number" 
                      class="form-control" required #licenseNumberInput="ngModel" />
                    <div *ngIf="licenseNumberInput.invalid && licenseNumberInput.touched" class="text-danger mt-1">
                      <small>License number is required</small>
                    </div>
                  </div>

                  <!-- Provider Title -->
                  <div class="field mb-3">
                    <label for="providerTitle" class="form-label">Provider Title</label>
                    <input type="text" pInputText id="providerTitle" name="providerTitle" 
                      [(ngModel)]="registrationData.providerTitle" placeholder="Enter your professional title" 
                      class="form-control" required #providerTitleInput="ngModel" />
                    <div *ngIf="providerTitleInput.invalid && providerTitleInput.touched" class="text-danger mt-1">
                      <small>Provider title is required</small>
                    </div>
                  </div>

                  <!-- Estimated Duration -->
                  <div class="field mb-3">
                    <label for="estimatedDuration" class="form-label">Estimated Duration (minutes)</label>
                    <input type="number" pInputText id="estimatedDuration" name="estimatedDuration" 
                      [(ngModel)]="registrationData.estimatedDuration" placeholder="Enter estimated appointment duration" 
                      class="form-control" required min="15" max="180" #estimatedDurationInput="ngModel" />
                    <div *ngIf="estimatedDurationInput.invalid && estimatedDurationInput.touched" class="text-danger mt-1">
                      <small>Estimated duration is required</small>
                    </div>
                  </div>
                </form>
              </div>


            </div>
          </div>

          <!-- Navigation Buttons -->
          <div class="step-navigation mt-4 d-flex justify-content-between">
            <p-button *ngIf="activeStepIndex > 0" label="Previous" icon="pi pi-chevron-left" 
              styleClass="p-button-secondary" (onClick)="previousStep()">
            </p-button>
            
            <div class="ms-auto">
              <p-button *ngIf="activeStepIndex < steps.length - 1" label="Next" icon="pi pi-chevron-right" 
                iconPos="right" styleClass="p-button-primary" (onClick)="nextStep()" 
                [disabled]="!isCurrentStepValid()">
              </p-button>
              
              <p-button *ngIf="activeStepIndex === steps.length - 1" label="Create Account" 
                icon="pi pi-check" styleClass="p-button-success" (onClick)="onRegister()" 
                [loading]="isLoading" [disabled]="!isCurrentStepValid()">
              </p-button>
            </div>
          </div>

          <!-- Sign In Link -->
          <div class="signin-section text-center mt-4">
            <span class="signin-text">Already have an account? </span>
            <a [routerLink]="['/login']" routerLinkActive="router-link-active" class="signin-link">
              Sign in
            </a>
          </div>
        </div>
      </div>


    </div>
  </div>
</div>
